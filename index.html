<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <!-- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–≥ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      height: 100dvh; /* dvh –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π */
      background: #f0f0f0;
    }

    /* --- –®–∞–ø–∫–∞ --- */
    #header {
      background: #0078ff;
      color: #fff;
      padding: 14px 16px;
      font-size: 17px;
      font-weight: 600;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #status {
      font-size: 12px;
      font-weight: 400;
      opacity: 0.85;
    }

    /* --- –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π --- */
    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      /* –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
      -webkit-overflow-scrolling: touch;
    }

    /* --- –°–æ–æ–±—â–µ–Ω–∏–µ --- */
    .msg {
      max-width: 75%;
      padding: 8px 12px;
      border-radius: 16px;
      font-size: 15px;
      line-height: 1.4;
      word-break: break-word;
      position: relative;
    }

    /* –í—Ä–µ–º—è –≤–Ω—É—Ç—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏—è */
    .msg .time {
      display: block;
      font-size: 11px;
      margin-top: 4px;
      opacity: 0.65;
      text-align: right;
    }

    /* –ú–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî —Å–ø—Ä–∞–≤–∞, —Å–∏–Ω–∏–µ */
    .msg.mine {
      align-self: flex-end;
      background: #0078ff;
      color: #fff;
      border-bottom-right-radius: 4px;
    }

    /* –ß—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî —Å–ª–µ–≤–∞, –±–µ–ª—ã–µ */
    .msg.theirs {
      align-self: flex-start;
      background: #fff;
      color: #222;
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,.1);
    }

    /* –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    .msg.system {
      align-self: center;
      background: transparent;
      color: #999;
      font-size: 12px;
      padding: 4px 8px;
    }

    /* --- –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ --- */
    #form {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      flex-shrink: 0;
      /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è iPhone —Å "—á—ë–ª–∫–æ–π" */
      padding-bottom: max(10px, env(safe-area-inset-bottom));
    }

    #input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #ccc;
      border-radius: 24px;
      font-size: 15px;
      outline: none;
      /* –ó–∞–ø—Ä–µ—Ç –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ iOS */
      font-size: max(16px, 1em);
      background: #f8f8f8;
    }

    #input:focus {
      border-color: #0078ff;
      background: #fff;
    }

    #send-btn {
      flex-shrink: 0;
      width: 44px;
      height: 44px;
      background: #0078ff;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
    }

    #send-btn:hover { background: #005ecc; }
    #send-btn:active { background: #0060cc; transform: scale(0.95); }

    /* –ò–∫–æ–Ω–∫–∞ —Å—Ç—Ä–µ–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ */
    #send-btn svg {
      width: 20px;
      height: 20px;
      fill: #fff;
    }

    /* --- –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É —á–∞—Ç–∞ --- */
    @media (min-width: 640px) {
      body {
        align-items: center;
        background: #dde3ea;
      }

      #chat-wrapper {
        width: 100%;
        max-width: 600px;
        height: 100dvh;
        display: flex;
        flex-direction: column;
        background: #f0f0f0;
        box-shadow: 0 0 30px rgba(0,0,0,.15);
      }
    }
  </style>
</head>
<body>

  <div id="chat-wrapper">
    <div id="header">
      <span>üí¨ –ß–∞—Ç</span>
      <span id="status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
    </div>

    <div id="messages"></div>

    <form id="form">
      <input
        id="input"
        type="text"
        placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..."
        autocomplete="off"
        enterkeyhint="send"
      />
      <button type="submit" id="send-btn">
        <!-- –ò–∫–æ–Ω–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M2 21l21-9L2 3v7l15 2-15 2z"/>
        </svg>
      </button>
    </form>
  </div>

  <script>
    const messagesEl = document.getElementById("messages");
    const statusEl   = document.getElementById("status");
    const form       = document.getElementById("form");
    const input      = document.getElementById("input");

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ç–æ–∫–æ–ª:
    // –ª–æ–∫–∞–ª—å–Ω–æ ‚Üí ws://, –Ω–∞ Railway ‚Üí wss://
    const protocol = location.protocol === "https:" ? "wss" : "ws";
    const ws = new WebSocket(`${protocol}://${window.location.host}`);

    ws.onopen = () => {
      statusEl.textContent = "Online ‚úÖ";
    };

    ws.onclose = () => {
      statusEl.textContent = "–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚ùå";
    };

    ws.onerror = () => {
      statusEl.textContent = "–û—à–∏–±–∫–∞ ‚ö†Ô∏è";
    };

    // --- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ –ø–∞–∫–µ—Ç—ã –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ ---
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);

      if (data.type === "history") {
        // –ü–æ–ª—É—á–∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ ‚Äî —Ä–∏—Å—É–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        data.messages.forEach((msg) => addMessage(msg.text, "theirs", msg.time));

      } else if (data.type === "message") {
        // –û–±—ã—á–Ω–æ–µ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addMessage(data.message.text, "theirs", data.message.time);
      }
    };

    // --- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è ---
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text || ws.readyState !== WebSocket.OPEN) return;

      // –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
      const time = new Date().toLocaleTimeString("ru-RU", { hour: "2-digit", minute: "2-digit" });

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ –≤–∏–¥–µ JSON
      ws.send(JSON.stringify({ text }));

      // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É —Å–µ–±—è
      addMessage(text, "mine", time);

      input.value = "";
      input.focus();
    });

    // --- –†–∏—Å—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ ---
    function addMessage(text, type, time) {
      const div = document.createElement("div");
      div.className = `msg ${type}`;

      const textNode = document.createTextNode(text);
      div.appendChild(textNode);

      // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –µ—Å–ª–∏ –µ—Å—Ç—å
      if (time) {
        const timeEl = document.createElement("span");
        timeEl.className = "time";
        timeEl.textContent = time;
        div.appendChild(timeEl);
      }

      messagesEl.appendChild(div);
      scrollToBottom();
    }

    // --- –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ ---
    function scrollToBottom() {
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —É–º–µ–Ω—å—à–∞–µ—Ç viewport ‚Äî
    // –ø—Ä–∏ –µ—ë –ø–æ—è–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —á–∞—Ç –≤–Ω–∏–∑
    window.addEventListener("resize", scrollToBottom);
  </script>

</body>
</html>
